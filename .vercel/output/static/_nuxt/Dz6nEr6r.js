import{_ as R,a as U}from"./CpPxmkwW.js";import{r as y,g as $,h as q,i as B,j as z,k as D,l as J,m as V,o as h,c as g,d as w,w as b,H as K,b as E,n as x,p as I,q as F,s as L,S as Q,v as W,x as X,a as Y}from"./Douj4D2a.js";import{u as j}from"./Qr56mRTH.js";import Z from"./gl5eVXUI.js";import"./DSskxJog.js";import"./Di32LYO2.js";import"./CD_gS3S9.js";import"./DmgdFr9v.js";const ee=q("html-content",()=>{const a=y(new Map);{const t=localStorage.getItem("html-content-cache");if(t)try{const e=JSON.parse(t);a.value=new Map(Object.entries(e))}catch(e){console.error("Error parsing cached content:",e)}B(a,e=>{const r=Object.fromEntries(e);localStorage.setItem("html-content-cache",JSON.stringify(r))},{deep:!0})}const u=(t,e)=>`${e}:${t}`;return{setContent:(t,e,r,_)=>{const c=u(t,_);a.value.set(c,{content:e,path:t,lastModified:Date.now(),sha:r,branch:_})},getContent:(t,e)=>{const r=u(t,e);return a.value.get(r)},getContentBySha:(t,e)=>Array.from(a.value.values()).find(r=>r.sha===t&&r.branch===e),clearContent:(t,e)=>{const r=u(t,e);a.value.delete(r)},clearBranchContent:t=>{for(const[e,r]of a.value.entries())r.branch===t&&a.value.delete(e)},clearAllContent:()=>{a.value.clear(),localStorage.removeItem("html-content-cache")}}}),te=a=>{const u=ee(),{getRawContent:C,saveFileContent:m,currentBranch:l}=j(),o=y(!1),v=y(null),d=y(null),t=$(()=>{const c=u.getContent(a,l.value);return(c==null?void 0:c.content)||""}),e=async()=>{var c;try{const n=await fetch(`https://api.github.com/repos/tiresomefanatic/test-nuxt/commits?path=${a}&sha=${l.value}`,{headers:{Accept:"application/vnd.github.v3+json"}});if(!n.ok)throw new Error("Failed to fetch commit info");const p=(c=(await n.json())[0])==null?void 0:c.sha;if(!d.value||d.value!==p){const k=u.getContentBySha(p,l.value);if(k)return console.log("Found cached content for SHA:",p,"in branch:",l.value),k.content;console.log("Fetching new content for SHA:",p,"in branch:",l.value);const f=await C("tiresomefanatic","test-nuxt",a,l.value);return u.setContent(a,f,p,l.value),d.value=p,f}return t.value}catch(n){return console.error("Error checking GitHub content:",n),t.value}};return{content:t,loading:o,error:v,fetchContent:async(c=!1)=>{o.value=!0,v.value=null;try{return c?await e():t.value?(e(),t.value):await e()}catch(n){throw v.value=n,n}finally{o.value=!1}},saveContent:async c=>{o.value=!0,v.value=null;try{const n=await m("tiresomefanatic","test-nuxt",a,c,`Update ${a}`,l.value);n&&n.commit&&n.commit.sha&&(u.setContent(a,c,n.commit.sha,l.value),d.value=n.commit.sha)}catch(n){throw v.value=n,n}finally{o.value=!1}}}},ne=window.setInterval,ae={class:"page-wrapper"},oe={key:0},se={key:0,class:"sidebar"},re={key:0,class:"content-header"},ce={key:0,class:"editor-container"},le=["innerHTML"],ie={key:1,class:"loading-state"},ue=z({__name:"[...slug]",setup(a){const{isLoggedIn:u,currentBranch:C}=j(),{showToast:m}=X(),l=y(!1),o=y(!1),v=y("");y(null);const d=y(!1),e=D().params.slug||[],r=Array.isArray(e)?e.join("/"):e,_=$(()=>r!==""),c=$(()=>r?`content/${r}.md`:"content/index.md"),{content:n,loading:M,error:p,fetchContent:H,saveContent:k}=te(c.value),f=async(s=!1)=>{l.value=!0;try{const i=await H(s);v.value=i}catch(i){console.error("Content loading error:",i),m({title:"Error",message:`Failed to load content from branch: ${C.value}`,type:"error"})}finally{l.value=!1}},A=async()=>{document.visibilityState==="visible"&&!o.value&&await f()},N=async()=>{if(!u.value){m({title:"Authentication Required",message:"Please sign in with GitHub to edit content",type:"warning"});return}o.value=!0,await f(!0),await W(),d.value=!0},O=s=>{v.value=s},P=async s=>{if(!s||!u.value){m({title:"Error",message:"Please sign in to save changes",type:"error"});return}try{console.log(`Saving content to branch: ${C.value}`),await k(s),m({title:"Success",message:`Content saved successfully to branch: ${C.value}`,type:"success"}),o.value=!1,d.value=!1,v.value=s}catch(i){console.error("Error saving content:",i),m({title:"Error",message:`Failed to save to branch: ${C.value}`,type:"error"})}},T=s=>{m({title:"Editor Error",message:s.message,type:"error"})},G=async()=>{d.value=!1,await f(!0),o.value=!1};return B(o,async(s,i)=>{s&&!i?await f(!0):!s&&i&&(d.value=!1)}),B(C,async(s,i)=>{s!==i&&(console.log(`Branch changed from ${i} to ${s}, reloading content...`),await f(!0))}),J(()=>{{f(!1),document.addEventListener("visibilitychange",A);const s=ne(async()=>{o.value||await f(!1)},16e4);V(()=>{clearInterval(s),document.removeEventListener("visibilitychange",A)})}}),(s,i)=>{const S=U;return h(),g("div",ae,[w(S,null,{default:b(()=>[l.value?(h(),g("div",ie,"Loading...")):(h(),g("div",oe,[w(K),E("div",{class:I(["content-area",{"editing-mode":o.value}])},[!o.value&&_.value?(h(),g("aside",se,[w(Z)])):x("",!0),E("div",{class:I(["main-content",{"with-sidebar":!o.value&&_.value}])},[F(u)?(h(),g("div",re,[w(S,null,{default:b(()=>[o.value?(h(),g("button",{key:1,onClick:G,class:"edit-button"}," Exit ")):(h(),g("button",{key:0,onClick:N,class:"edit-button"}," Edit "))]),_:1})])):x("",!0),w(S,null,{default:b(()=>[o.value?(h(),g("div",ce,[(h(),L(Q,null,{default:b(()=>[d.value?(h(),L(R,{key:0,content:v.value,filePath:c.value,"onUpdate:content":O,onSave:P,onError:T},null,8,["content","filePath"])):x("",!0)]),fallback:b(()=>i[0]||(i[0]=[E("div",{class:"loading-state"},"Loading editor...",-1)])),_:1}))])):(h(),g("div",{key:1,class:"prose-content",innerHTML:F(n)},null,8,le))]),_:1})],2)],2)]))]),_:1})])}}}),pe=Y(ue,[["__scopeId","data-v-e9b11c31"]]);export{pe as default};
