import{ab as X,v as P,g as Z,r as m,i as x,k as ee,l as te,o as a,c as o,b as s,N as $,O as N,e as D,p as v,C as se,n as y,J as ae,K as oe,q,t as l,a as ne}from"./DpbXZn14.js";import{u as re,C as le}from"./DES18ZVy.js";const ie=X("editor",{state:()=>{const r=localStorage.getItem("editor-saves");return{savedContents:r?JSON.parse(r):{},currentBranch:"main"}},getters:{getSavedContents:r=>_=>{const c=`${_}-${r.currentBranch}`;return r.savedContents[c]||[]}},actions:{saveContent(r,_){const{showToast:c}=P(),i=`${r}-${this.currentBranch}`,d={content:_,timestamp:new Date().toISOString(),branch:this.currentBranch,filePath:r};this.savedContents[i]||(this.savedContents[i]=[]),this.savedContents[i].push(d),localStorage.setItem("editor-saves",JSON.stringify(this.savedContents)),c({title:"Changes Saved",description:`Changes saved locally on branch "${this.currentBranch}"`})},loadSaves(){const r=localStorage.getItem("editor-saves");r&&(this.savedContents=JSON.parse(r))},setBranch(r){this.currentBranch=r,localStorage.setItem("editor-saves",JSON.stringify(this.savedContents))},clearSaves(r){const{showToast:_}=P(),c=`${r}-${this.currentBranch}`;this.savedContents[c]&&(delete this.savedContents[c],localStorage.setItem("editor-saves",JSON.stringify(this.savedContents)),_({title:"Saves Cleared",description:`All local saves cleared for "${r}" on branch "${this.currentBranch}"`}))},deleteSave(r,_){const{showToast:c}=P(),i=`${r}-${this.currentBranch}`;this.savedContents[i]&&(this.savedContents[i]=this.savedContents[i].filter(d=>d.timestamp!==_),localStorage.setItem("editor-saves",JSON.stringify(this.savedContents)),c({title:"Save Deleted",description:`Local save deleted from branch "${this.currentBranch}"`}))}}}),ce={key:0},ue={key:1},de={class:"sidebar-content"},he={class:"tabs"},ve=["onClick"],_e={key:0,class:"count"},me={class:"tab-content"},be={key:0,class:"history-tab"},ge={key:0,class:"loading-state"},ye={key:1,class:"empty-state"},pe={key:2,class:"commit-list"},fe=["onClick"],Ce={class:"commit-header"},ke={class:"commit-message"},we={class:"commit-meta"},Se={class:"commit-author"},Be=["src","alt"],$e={class:"commit-sha"},Ne={class:"commit-date"},Te={key:1},qe={class:"pr-actions-header"},Pe={key:1,class:"loading-state"},Ee={key:2,class:"empty-state"},Re={key:3,class:"pr-list"},Oe={class:"pr-header"},De={class:"pr-number"},Le={class:"pr-title"},Ie={class:"pr-meta"},Je={class:"pr-author"},xe=["src","alt"],Ae={class:"pr-actions"},Fe=["onClick"],Me={key:2},Ve={key:0,class:"branch-controls"},He={class:"branch-select-wrapper"},Ge=["value"],je=["value"],ze={key:1,class:"new-branch-form"},Ue={class:"branch-actions"},Ke=["disabled"],Ye={key:1,class:"login-prompt"},Qe={key:3},We={key:0,class:"empty-state"},Xe={key:1,class:"saves-list"},Ze={class:"save-info"},et={class:"save-timestamp"},tt={class:"save-branch"},st={class:"save-actions"},at=["onClick"],ot=["onClick"],nt=Z({__name:"CollaborationSidebar",props:{filePath:{}},emits:["load-save"],setup(r,{emit:_}){const c=r,i=m(!1),d=m("history"),h=m(!1),p=m([]),f=m([]),C=m(!1),b=m(""),k=m(!1),{isLoggedIn:w,currentBranch:E,branches:R,getCommits:A,getPullRequests:F,fetchBranches:L,switchBranch:M,createBranch:V,resolveConflict:lt}=re(),{showToast:g}=P(),I=ie(),O=x(()=>I.getSavedContents(c.filePath)),H=x(()=>{var t,n,e;return[{id:"history",label:"History",count:p.value.length},{id:"branches",label:"Branches",count:((t=R.value)==null?void 0:t.length)||0},{id:"prs",label:"Pull Requests",count:((n=f.value)==null?void 0:n.length)||0},{id:"saves",label:"Saves",count:((e=O.value)==null?void 0:e.length)||0}]}),G=()=>{i.value=!i.value},j=async t=>{d.value=t,t==="history"?await S():t==="prs"&&await T()},S=async()=>{if(w.value){h.value=!0;try{const t=await A();t&&Array.isArray(t)&&(p.value=t,console.log("Loaded commits:",p.value))}catch(t){console.error("Error loading commits:",t),g({title:"Error",message:"Failed to load commit history",type:"error"})}finally{h.value=!1}}},z=t=>{if(t.html_url)window.open(t.html_url,"_blank");else{const n=`https://github.com/tiresomefanatic/test-nuxt/commit/${t.sha}`;window.open(n,"_blank")}},T=async()=>{if(w.value){h.value=!0;try{const t=await F();t&&Array.isArray(t)&&(f.value=t,console.log("Loaded pull requests:",f.value))}catch(t){console.error("Error loading pull requests:",t),g({title:"Error",message:"Failed to load pull requests",type:"error"})}finally{h.value=!1}}},U=async t=>{const e=t.target.value;if(!(!e||e===E.value)){h.value=!0;try{await M(e)&&(await S(),g({title:"Success",message:`Switched to branch: ${e}`,type:"success"}))}catch(u){console.error("Error switching branch:",u),g({title:"Error",message:"Failed to switch branch",type:"error"})}finally{h.value=!1}}},K=async()=>{if(b.value){h.value=!0;try{await V(b.value)&&(g({title:"Success",message:`Created branch: ${b.value}`,type:"success"}),b.value="",C.value=!1,await S())}catch(t){console.error("Error creating branch:",t),g({title:"Error",message:"Failed to create branch",type:"error"})}finally{h.value=!1}}},Y=t=>t.mergeable===!1?"Has Conflicts":t.mergeable===!0?"Ready to Merge":"Checking",Q=t=>{window.open(t,"_blank")},W=async()=>{k.value=!1,await T()},J=t=>{const n=new Date(t),u=new Date().getTime()-n.getTime(),B=Math.floor(u/(1e3*60*60*24));return B===0?"Today":B===1?"Yesterday":B<7?`${B} days ago`:n.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return ee(w,async t=>{t&&(await L(),await S(),await T())}),te(async()=>{w.value&&(await L(),await S(),await T())}),(t,n)=>(a(),o("div",{class:q(["collaboration-sidebar",{open:i.value}])},[s("button",{class:"toggle-button",onClick:G},[i.value?(a(),o("span",ue,"×")):(a(),o("span",ce,"☰"))]),s("div",de,[s("div",he,[(a(!0),o($,null,N(H.value,e=>(a(),o("button",{key:e.id,class:q(["tab-button",{active:d.value===e.id}]),onClick:u=>j(e.id)},[D(l(e.label)+" ",1),e.count?(a(),o("span",_e,l(e.count),1)):v("",!0)],10,ve))),128))]),s("div",me,[d.value==="history"?(a(),o("div",be,[h.value?(a(),o("div",ge,n[5]||(n[5]=[s("div",{class:"spinner"},null,-1),D(" Loading commits... ")]))):p.value.length===0?(a(),o("div",ye," No commit history available ")):(a(),o("div",pe,[(a(!0),o($,null,N(p.value,e=>{var u;return a(),o("div",{key:e.sha,class:"commit-item",onClick:B=>z(e),title:"Click to view on GitHub"},[s("div",Ce,[s("div",ke,l(e.commit.message),1)]),s("div",we,[s("div",Se,[(u=e.author)!=null&&u.avatar_url?(a(),o("img",{key:0,src:e.author.avatar_url,alt:e.commit.author.name,class:"author-avatar"},null,8,Be)):v("",!0),s("span",null,l(e.commit.author.name),1)]),s("div",$e,l(e.sha.substring(0,7)),1),s("div",Ne,l(J(e.commit.author.date)),1)])],8,fe)}),128))]))])):v("",!0),d.value==="prs"?(a(),o("div",Te,[s("div",qe,[k.value?v("",!0):(a(),o("button",{key:0,class:"create-pr-button",onClick:n[0]||(n[0]=e=>k.value=!0)}," Create Pull Request "))]),k.value?(a(),se(le,{key:0,branches:y(R),currentBranch:y(E),onCreated:W,onCancel:n[1]||(n[1]=e=>k.value=!1)},null,8,["branches","currentBranch"])):h.value?(a(),o("div",Pe," Loading pull requests... ")):f.value.length===0?(a(),o("div",Ee," No open pull requests ")):(a(),o("div",Re,[(a(!0),o($,null,N(f.value,e=>(a(),o("div",{key:e.number,class:q(["pr-item",{"has-conflicts":e.mergeable===!1}])},[s("div",Oe,[s("span",De,"#"+l(e.number),1),s("span",Le,l(e.title),1)]),s("div",Ie,[s("span",Je,[s("img",{src:e.user.avatar_url,alt:e.user.login,class:"author-avatar"},null,8,xe),D(" "+l(e.user.login),1)]),s("span",{class:q(["pr-status",e.mergeable_state])},l(Y(e)),3)]),s("div",Ae,[s("button",{class:"action-button",onClick:u=>Q(e.html_url)}," View on GitHub ",8,Fe)])],2))),128))]))])):v("",!0),d.value==="branches"?(a(),o("div",Me,[y(w)?(a(),o("div",Ve,[s("div",He,[n[6]||(n[6]=s("label",null,"Current Branch:",-1)),s("select",{value:y(E),onChange:U,class:"branch-select"},[(a(!0),o($,null,N(y(R),e=>(a(),o("option",{key:e,value:e},l(e),9,je))),128))],40,Ge)]),C.value?v("",!0):(a(),o("button",{key:0,onClick:n[2]||(n[2]=e=>C.value=!0),class:"create-branch-button"}," Create New Branch ")),C.value?(a(),o("div",ze,[ae(s("input",{"onUpdate:modelValue":n[3]||(n[3]=e=>b.value=e),placeholder:"Enter branch name",class:"branch-input"},null,512),[[oe,b.value]]),s("div",Ue,[s("button",{onClick:K,disabled:!b.value,class:"create-button"}," Create ",8,Ke),s("button",{onClick:n[4]||(n[4]=e=>C.value=!1),class:"cancel-button"}," Cancel ")])])):v("",!0)])):(a(),o("div",Ye," Please log in to manage branches "))])):v("",!0),d.value==="saves"?(a(),o("div",Qe,[O.value.length===0?(a(),o("div",We," No saved changes available ")):(a(),o("div",Xe,[(a(!0),o($,null,N(O.value,e=>(a(),o("div",{key:e.timestamp,class:"save-item"},[s("div",Ze,[s("span",et,l(J(e.timestamp)),1),s("span",tt,"on branch "+l(e.branch),1)]),s("div",st,[s("button",{onClick:u=>t.$emit("load-save",e.content),class:"action-button"}," Load ",8,at),s("button",{onClick:u=>y(I).deleteSave(c.filePath,e.timestamp),class:"action-button delete"}," Delete ",8,ot)])]))),128))]))])):v("",!0)])])],2))}}),rt=ne(nt,[["__scopeId","data-v-1712884a"]]),ut=Object.freeze(Object.defineProperty({__proto__:null,default:rt},Symbol.toStringTag,{value:"Module"}));export{rt as C,ut as a,ie as u};
